import requests, logging, json, os, sys, time
import mimetypes
from dotenv import load_dotenv
import pandas as pd
import json

load_dotenv();
API_BASE = os.getenv("API_BASE")
API_CLIENT = os.getenv("API_CLIENT")
API_KEY = os.getenv("API_KEY")
COD_TAREFA = os.getenv("COD_TAREFA")
USUARIO = os.getenv("USUARIO")
SENHA = os.getenv("SENHA")
AUTENTICACAO = os.getenv("AUTENTICACAO")
TOKEN_CLIENT = os.getenv("TOKEN_CLIENT")

cod_fluxo = input("Qual o c√≥digo do processo? : ") #3280
Email = input("Email ADM Cadastrado:");

def call_api_login():
    url = f"{API_BASE}/api/v2/Usuario/ValidarLogin"
    files = {
        'dsUsuario': (None, 'root.fg'),
        'dsSenha': (None, 'Fg@2025@')
    }
    headers = {'dsCliente': API_CLIENT, 'dsChaveAutenticacao': AUTENTICACAO}
    resp = requests.post(url, headers=headers, files=files)
    resp.raise_for_status()
    token = resp.json().get("tokenUsuario")
    logging.info("Login OK, token recebido")
    return token

token = call_api_login()
def pular_fluxo():
    url = "https://portal.smartshare.com.br:443/fg/SmartshareAPI/api/v1/Fluxo/AvancaFluxo"
    headers = {
        "Content-Type": "application/json",
        "Accept": "application/json",
        "dsCliente": "mobile",
        "cdFluxo": str(cod_fluxo),
        "dsChaveAutenticacao": AUTENTICACAO,
        "tokenUsuario": str(token),
        "dsEmailExecutor": str(Email)
    }
    print("FLUXO:", cod_fluxo)

    body = {
      "cdFluxo":  str(cod_fluxo),  
      "dsEmailExecutor": f"{Email}"
    }
    response = requests.post(url, headers=headers, json=body)
    print("STATUS:", response.status_code)
    print("BODY:", response.text)
    print(response.request.headers)
    print(response.request.body)

    response.raise_for_status()
    return response

print(pular_fluxo());



headers = {         #| Define as variaveis do Header.
        "Content-Type": "application/json",
        "Accept": "application/json",
        "dsCliente": "mobile",
        "cdProcesso": cod_Processo, 
        "dsChaveAutenticacao": AUTENTICACAO,
        "tokenUsuario": str(TOKEN),    #| Token gerado pelo Smart Share. 
    }